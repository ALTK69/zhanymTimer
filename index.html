<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>zhanym timer</title>
  <style>
    /* --- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω --- */

  /* --- –ê–Ω–∏–º–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–µ–∫ --- */
.heart {
  position: fixed;
  bottom: -30px;
  font-size: 24px;
  animation: floatUp 6s linear forwards;
  pointer-events: none;
}
@keyframes floatUp {
  0% { transform: translateY(0) scale(1); opacity: 1; }
  50% { transform: translateY(-200px) scale(1.3); opacity: 0.7; }
  100% { transform: translateY(-600px) scale(0.8); opacity: 0; }
}

/* --- –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ—Ç–∏–∫–æ–≤ --- */
.cat {
  position: fixed;
  bottom: 20px;
  font-size: 48px;
  animation: bounce 3s infinite ease-in-out;
}
.cat.left { left: 20px; }
.cat.right { right: 20px; }
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

/* --- –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ --- */
.btn {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.btn:active {
  transform: scale(0.9);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}


    
    :root{
      --bg: #f7fafc; /* very light */
      --card: #ffffff;
      --accent: #a3d9c9; /* pastel */
      --accent-2: #f6c7c7;
      --muted: #6b7280;
      --shadow: 0 6px 18px rgba(15,23,42,0.06);
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: linear-gradient(180deg, var(--bg), #ffffff);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
      color:#111827;
    }
    .container{
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:24px;
    }
    @media (max-width:880px){
      .container{grid-template-columns:1fr;}
    }

    .card{
      background:var(--card);
      border-radius:16px;
      padding:20px;
      box-shadow:var(--shadow);
    }

    /* Left: timer */
    .timer-wrap{display:flex;flex-direction:column;align-items:center;gap:18px;padding:36px}
    .circle{
      width:280px;height:280px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;position:relative;
      background: conic-gradient(var(--accent) 0deg, rgba(0,0,0,0.04) 0deg);
      transition: background 0.3s ease;
      box-shadow: 0 8px 30px rgba(99,102,241,0.05) inset;
    }
    @media (max-width:520px){ .circle{width:220px;height:220px}}
    .circle .center{
      width:78%;height:78%;background:var(--card);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
    }
    .time{font-size:44px;font-weight:600}
    .mode{font-size:14px;color:var(--muted);margin-top:6px}

    .controls{display:flex;gap:12px}
    .btn{
      border:0;padding:10px 16px;border-radius:10px;background:var(--accent);cursor:pointer;font-weight:600;box-shadow:0 8px 20px rgba(0,0,0,0.06);
    }
    .btn.secondary{background:var(--card);border:1px solid #e6e9ef}
    .btn.warn{background:var(--accent-2)}

    /* Right column: settings + users */
    .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    label{font-size:13px;color:var(--muted)}
    input[type="number"], input[type="text"], select{
      padding:8px;border-radius:8px;border:1px solid #eef2f7;background:transparent
    }

    .users-list{display:flex;flex-direction:column;gap:8px}
    .user{display:flex;align-items:center;gap:12px;padding:8px;border-radius:8px;background:#fbfdfe;border:1px solid #eef6f4}
    .dot{width:10px;height:10px;border-radius:50%}
    .small{font-size:13px;color:var(--muted)}

    footer.small{margin-top:12px;color:var(--muted);font-size:13px}

    /* tiny responsive tweaks */
    @media (max-width:480px){
      .time{font-size:36px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card timer-wrap">
      <div style="width:100%;display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>Pomodoro Timer</strong>
          <div class="small">–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä –¥–ª—è –¥–≤—É—Ö –ª—é–¥–µ–π</div>
        </div>
        <div style="text-align:right">
          <div class="small">–ö–æ–º–Ω–∞—Ç–∞ –ª—é–±–≤–∏  <span id="roomId">love</span></div> 
        </div>
      </div>

      <div class="circle" id="circle">
        <div class="center">
          <div class="time" id="timeDisplay">25:00</div>
          <div class="mode" id="modeDisplay">Study ‚Ä¢ Cycle 1</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="startPauseBtn">Start</button>
        <button class="btn secondary" id="resetBtn">Reset</button>
        <button class="btn warn" id="skipBtn">Skip</button>
      </div>

      <div style="width:100%;margin-top:8px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <div class="small">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ: <span id="lastAction">‚Äî</span></div>
      </div>

      <footer class="small">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π. –ü–æ–º–µ–Ω—è–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø—Ä–∞–≤–∞ –∫–∞–∫ —Ç–µ–±–µ —É–¥–æ–±–Ω–æ, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ Start –ñ–∞–Ω—ã–º :3</footer>
    </div>

    <div class="card">
      <div class="field">
        <label>–ù–∏–∫–Ω–µ–π–º</label>
        <input id="username" type="text" placeholder="–í–≤–µ–¥–∏ –Ω–∏–∫ –ñ–∞–Ω..." />
      </div>

      <div class="field">
        <label>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–∏–Ω—É—Ç—ã)</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <div><label class="small">Work</label><input id="workMin" type="number" min="1" value="25" /></div>
          <div><label class="small">Short break</label><input id="shortMin" type="number" min="1" value="5" /></div>
          <div><label class="small">Long break</label><input id="longMin" type="number" min="1" value="15" /></div>
        </div>
      </div>

      <div class="field">
        <label>–¶–∏–∫–ª—ã –¥–æ –¥–ª–∏–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞</label>
        <input id="cyclesBeforeLong" type="number" min="1" value="4" />
      </div>

      <div class="field">
        <label>–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–º–æ–∏ —Ç–≤–∏–Ω–∫–∏ :3)</label>
        <div class="users-list" id="usersList"></div>
      </div>

      <div style="margin-top:8px" class="small">
        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–¥–µ—Ü:</strong>
        <div> –æ—á–∏—Å—Ç–∏—Ç–µ —Ä–∞–∑—É–º, –ø–æ–π–º–∞–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ñ–æ–∫—É—Å –∏ –ø–æ–¥—É–º–∞–π –æ —Å–≤–µ–æ–º –ø–∞—Ä—Ç–Ω–µ—Ä–µ ( –ñ–∞–Ω—ã–º :3 ) –≤–æ–∑—å–º–∏ –≤—Å–µ —Å–≤–æ–∏ —á—É—Å—Ç–≤–∞ –≤ —Ä—É–∫–∏ –∏ –ø–æ–ø—ã—Ç–∞–π—Å—è –∏—Ö –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ —Ç—ã—Å—è—á–∏ –∫–∏–ª–æ–º–µ—Ç—Ä–æ–≤ —á—Ç–æ –º–µ–∂–¥—É –Ω–∞–º–∏—é /</div>
      </div>

      <div style="margin-top:12px" class="small">–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ù–∞—à–∏ —Å–µ—Ä–¥—Ü–∞ —É–∂–µ –∏ —Ç–∞–∫ —Å–æ–µ–¥–µ–Ω—ã–π –∏ –º—ã –±—É–∫–≤–∞–ª—å–Ω–æ —Å–ª–∏–≤–∞–µ–º—Å—è –≤ –æ–¥–Ω—É –¥—É—à—É üíö</div>
    </div>
  </div>

  <!-- Firebase (compat) CDN - –∏—Å–ø–æ–ª—å–∑—É–µ–º compat —á—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
/*******************
 *  –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
 *******************/

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyA1M0QuJABvZdOLAEbA28jhnJuRkHNkrYo",
  authDomain: "zhanym-6d7e8.firebaseapp.com",
  databaseURL: "https://zhanym-6d7e8-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "zhanym-6d7e8",
  storageBucket: "zhanym-6d7e8.firebasestorage.app",
  messagingSenderId: "115835636741",
  appId: "1:115835636741:web:a800faa31340052702606c",
  measurementId: "G-DDZK46WJ3Z"
};

const ROOM_ID = "default";
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const roomRef = db.ref("rooms/" + ROOM_ID + "/state");
const usersRef = db.ref("rooms/" + ROOM_ID + "/users");

// DOM
const timeDisplay = document.getElementById("timeDisplay");
const modeDisplay = document.getElementById("modeDisplay");
const startPauseBtn = document.getElementById("startPauseBtn");
const resetBtn = document.getElementById("resetBtn");
const skipBtn = document.getElementById("skipBtn");
const usernameInput = document.getElementById("username");
const usersList = document.getElementById("usersList");
const lastAction = document.getElementById("lastAction");
const circle = document.getElementById("circle");

const workMinInput = document.getElementById("workMin");
const shortMinInput = document.getElementById("shortMin");
const longMinInput = document.getElementById("longMin");
const cyclesBeforeLongInput = document.getElementById("cyclesBeforeLong");

document.getElementById("roomId").textContent = ROOM_ID;

// –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
let localUserId = "u_" + Math.random().toString(36).slice(2, 9);
usernameInput.value = "User-" + localUserId.slice(-3);

function getSettingsFromInputs() {
  return {
    work: parseInt(workMinInput.value) || 25,
    short: parseInt(shortMinInput.value) || 5,
    long: parseInt(longMinInput.value) || 15,
    cyclesBeforeLong: parseInt(cyclesBeforeLongInput.value) || 4
  };
}

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
function getRemaining(state) {
  if (state.running && state.startTime && state.durationMs) {
    const elapsed = Date.now() - state.startTime;
    return Math.max(0, state.durationMs - elapsed);
  }
  return state.remainingMs || 0;
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
function render(state) {
  const remaining = getRemaining(state);
  const mm = String(Math.floor(remaining / 60000)).padStart(2, "0");
  const ss = String(Math.floor((remaining % 60000) / 1000)).padStart(2, "0");
  timeDisplay.textContent = `${mm}:${ss}`;
  modeDisplay.textContent = `${state.mode} ‚Ä¢ Cycle ${state.cycle}`;
  startPauseBtn.textContent = state.running ? "Pause" : "Start";
  lastAction.textContent = state.lastActionBy || "‚Äî";

  const pct = state.durationMs ? (1 - remaining / state.durationMs) : 0;
  circle.style.background = `conic-gradient(var(--accent) ${pct * 360}deg, rgba(0,0,0,0.04) ${pct * 360}deg)`;
}

// –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
async function ensureRoomState() {
  const snap = await roomRef.once("value");
  if (!snap.exists()) {
    const s = getSettingsFromInputs();
    roomRef.set({
      mode: "work",
      cycle: 1,
      running: false,
      startTime: null,
      durationMs: s.work * 60000,
      remainingMs: s.work * 60000,
      settings: s,
      lastActionBy: null
    });
  }
}

// –°–ª—É—à–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
let currentState = null;
roomRef.on("value", (snap) => {
  if (!snap.exists()) return;
  currentState = snap.val();
  render(currentState);
});

// Start / Pause
startPauseBtn.onclick = async () => {
  const snap = await roomRef.once("value");
  const st = snap.val();
  if (!st) return;

  if (st.running) {
    // –ü–∞—É–∑–∞
    const remaining = getRemaining(st);
    await roomRef.update({
      running: false,
      remainingMs: remaining,
      startTime: null,
      lastActionBy: usernameInput.value
    });
  } else {
    // –°—Ç–∞—Ä—Ç
    const duration = st.remainingMs || getSettingsFromInputs().work * 60000;
    await roomRef.update({
      running: true,
      startTime: Date.now(),
      durationMs: duration,
      lastActionBy: usernameInput.value
    });
  }
};

// Reset
resetBtn.onclick = async () => {
  const s = getSettingsFromInputs();
  await roomRef.set({
    mode: "work",
    cycle: 1,
    running: false,
    startTime: null,
    durationMs: s.work * 60000,
    remainingMs: s.work * 60000,
    settings: s,
    lastActionBy: usernameInput.value
  });
};

// Skip
skipBtn.onclick = async () => {
  const st = (await roomRef.once("value")).val();
  if (!st) return;
  const s = st.settings || getSettingsFromInputs();

  let mode = st.mode;
  let cycle = st.cycle;
  if (mode === "work") {
    if (cycle % s.cyclesBeforeLong === 0) {
      mode = "long";
    } else {
      mode = "short";
    }
  } else {
    if (mode === "long") cycle = 1;
    else cycle++;
    mode = "work";
  }

  const dur = mode === "work" ? s.work * 60000 : mode === "short" ? s.short * 60000 : s.long * 60000;
  await roomRef.set({
    mode,
    cycle,
    running: false,
    startTime: null,
    durationMs: dur,
    remainingMs: dur,
    settings: s,
    lastActionBy: usernameInput.value
  });
};

// –õ–æ–∫–∞–ª—å–Ω—ã–π –∞–ø–¥–µ–π—Ç —ç–∫—Ä–∞–Ω–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(() => {
  if (currentState) render(currentState);
}, 1000);

ensureRoomState();
</script>
<!-- –ö–æ—Ç–∏–∫–∏ –ø–æ –∫—Ä–∞—è–º -->
<div class="cat left">üê±</div>
<div class="cat right">üê±</div>

<script>
  // --- –°–µ—Ä–¥–µ—á–∫–∏ ---
  function spawnHeart() {
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = "üíñ";
    heart.style.left = Math.random() * window.innerWidth + "px";
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 6000);
  }

  // –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã ‚Äî —Å–µ—Ä–¥–µ—á–∫–æ
  setInterval(spawnHeart, 2000);

  // –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —ç–∫—Ä–∞–Ω—É ‚Äî —Å–µ—Ä–¥–µ—á–∫–æ
  document.body.addEventListener("click", spawnHeart);
</script>

</body>
</html>

